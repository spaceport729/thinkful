a. Return the name and purchase amount of the five customers in each state who have spent the most on our site.

WITH 
    total_spent 
AS (
    SELECT
            customers.name,
            customers.state,
            SUM (transactions.transact_amt) AS summed_transactions
    FROM 
            customers
    JOIN
            transactions
    ON
            customers.customer_id = transactions.customer_id
    GROUP BY
            customers.name
)

SELECT
    total_spent.name
    total_spent.summed_transactions
    ROW_NUMBER() OVER (PARTITION BY total_spent.state ORDER BY total_spent.summed_transactions DESC) AS row_number
FROM total_spent
WHERE row_number < 6;


b.The name most popular item in every state and the state.

SELECT
    products.product_name,
    customers.state,
    RANK() OVER (PARTITION BY customers.state ORDER BY COUNT(products.product_id) DESC) AS rank
FROM 
    transactions
JOIN
    products
ON
    transactions.product_id = products.product_id
JOIN
    customers
ON
    customers.customer_id = transactions.customer_id
WHERE rank =1;
